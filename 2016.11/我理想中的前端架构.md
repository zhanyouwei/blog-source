# 我理想中的前端架构

起笔原因是因为最近的工作。

我一直对前端的工作，抱有莫名的激情，不是因为我可以还原出多么酷炫的设计稿（我也算不上特别擅长~），而是因为前端距离用户太近了，近到，我愿意为了那0.1秒的差距费尽心机。

言归正传，

我一直在思考，前端如何更好的控制前端接入层，而不是开发完成后，拍拍屁股了事了！

我理想中的前端架构，此处应该有图

![](http://ww3.sinaimg.cn/large/006y8mN6jw1fact1eo0rtj30zk0qojtt.jpg)

一个基于Node.js的基础服务体系 `base-service`（还不成熟，但我想分享一下）。

这个 base-service 应该包含三个方面

1. Router
2. View
3. Model

看到，这三个会很容易联想到 MVC 架构（没错，我也是写过Java的同志），不过，我想要的可不仅仅是 MVC ~ 且听我娓娓道来。

### Router 路由层

现阶段的前端项目很多都已经前后端分离了，前端以静态资源文件的方式部署。那么带来的访问路径（router）控制自然就交到了 Nginx 层面去做。又或者 SPA 有自己的 Router 层，可是访问入口呢？还是得交由Nginx控制。通常开发并不掌握Nginx权限，那么怎么才能控制路由呢？我想到的是，自己提供一个路由服务，这样可以做到精细控制每一个链接的流转。

设想，如果有多个前端项目，且每个项目的技术栈不同，而我们却可以复用不同项目之间的页面。只要在路由层做相应控制就好了。

### View 层

虽然，传统的开发模式，弊端很多，不过至少有一种我们不可否认，那就是服务端渲染确实是有很多优势的。通过Node.js 接入View层的控制，可以做到页面的首屏渲染，以及SEO的优化（不要扯Google，至少百度做的不好，你知道我在指什么~），我甚至在考虑在首屏渲染之外为前端提供更多数据，省去ajax过程。比如一个列表页面，我可以在服务端渲染首屏的时候，就将余下的诸多数据预先塞给前端（当然，太多了，也不能全部塞，这需要权衡）。还没有数据对比，后续应该会补上。

### Model 层

前后端分离带来的首要问题就是 数据如何提供、数据何时提供、数据如何约定以及数据质量如何保证？

#### 数据如何提供

大家都是 Ajax + json ，貌似已经是一个标准

#### 数据何时提供

这也是一个前后端分离的优势，前端不在依赖后端，可独立开发。可前端终究需要调用接口数据，以确保最终效果。这时候如果有Mock数据就太棒了，那么问题来了，Mock数据由谁提供呢？由前端自己造？还是后端提供Mock接口提供？毕竟是一个体力活。

#### 数据如何约定

通常是定一个json格式的数据结构，大家做法各不同，有的是前端定义，有的是后端定义。这里还会出现一个问题，就是数据冗余（通常美其名曰：用不到的你忽略就好）。

#### 数据质量如何保证

一个常见的场景，

> 测试小丽@前端小李：唉，你这块页面显示不正常！
>
> 前端小李：啪啪啪！
>
> 前端小李@测试小丽：擦，这应该是后端数据不对！（数据不全 or 格式不对 。。。）
>
> 测试小丽@后端小王：喂，你这xxx数据不对啊！
>
> 后端小王：啪啪啪 ~ 
>
> 后端小王@测试小丽&前端小李：改好啦 ~~~

如何避免重复这样的对话呢？

#### 我想这么做

提供一个可视化的接口平台！提供以下功能

- 接口定义，支持自定义接口数据格式，前后端协作完成；
- Mock数据生成，根据接口定义，自动批量生成Mock数据；
- 接口测试，后端接口开发完成后，支持根据接口定义测试后端接口；

这就是我想在Model层做的事！

**其实 Router 层与 View 层还可以做很多事，可惜我还是一个Node.js的新手，暂且不表。**

全文完。