# 关于通用组件的一些想法

缘起，

最为一家电商公司，针对商品图片的管理是及其基础的一项服务，一个统一的图片空间管理服务则是其中必不可少的一项。

图片管理平台对外提供的一项基础服务则是图片的上传与引用，今天要说的就是这样一个插件。

作为一个服务于各个后端平台的基础插件，为了保证各个业务方在五分钟内以最小代价接入，组件在开发的过程中满足以下几点：

1. 轻松接入，只需一行脚本代码，即可引入一个包含UI以及全部完整交互功能的富UI组件；
2. 使用简单，只需配置简单参数即可；
3. 无忧升级，一次引入终身使用，后续版本升级全部由服务端下发；


##### 怎么用

```javascript
window.pictureSpace = new window.PictureSpace({
  userType: '',
  userId: '',
  srcType: '',
  srcId: '',
  tab: ['upload', 'select'],
  onSelectImage: (imageList) => {},
  onClose: () => {},
});
window.pictureSpace.show();
```



#### 说一说实现思路

为了实现轻松接入的特性，必须能够做到将所有 `HTML` `CSS` `JavaScript` 代码合并打包至一个 js 文件中，最终实现只需要引入一段 JS 脚本，即可拥有组件全部功能。

为了方便的进行版本管理，最好支持根据文件内容添加 「hash」值，打包工具上采用了Webpack@2.x 版本。

为了实现一次引入终身无忧的特性，在版本控制上采用了由服务端进行版本下发的方案。

##### 技术上

前端无非采用 HTML、CSS、JavaScript

MVVM 框架上采用了 `Vue.js2.x` 

UI组件采用了 `Element`

打包工具采用了 `Webpack2`

##### 仔细说一说，服务端下发版本

客户端层面引入的一段 JS，其实是服务端提供的一个服务，该服务在被调用时，会相应去根据数据库中对应的数据记录，动态拼接最新的文件CDN路径，通过301重定向给客户端。

#### 还想做

服务端其实可以发展成为一个组件管理平台，提供组件管理服务（基本的增删改查即可）。

最好每一个组件还能够配置相应的使用文档（其实支持Markdown解析即可）。

#### 尚未解决

- 如何保证一个富UI组件能够在嵌入第三方的网站而不被第三方 CSS 影响，目前的做法是采用 CSS 命名空间的方式，效果差，不能根治。